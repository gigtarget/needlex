{% extends "base_admin.html" %}

{% block content %}
<h2>🛠️ Add Machine</h2>

<form method="POST">
    <input type="text" name="machine_name" placeholder="Enter machine name" required>
    <select name="user_id" required>
        <option value="">Assign to user...</option>
        {% for user in users %}
            <option value="{{ user.id }}">{{ user.email }}</option>
        {% endfor %}
    </select>
    <input type="number" name="num_heads" min="1" max="15" placeholder="Number of heads (e.g. 8)" required>
    <button type="submit">Add Machine</button>
</form>

{% if machines %}
<h3>📋 All Machines</h3>
<table border="1">
    <tr>
        <th>#</th>
        <th>Machine</th>
        <th>User</th>
        <th>Heads</th>
    </tr>
    {% for machine in machines %}
    <tr>
        <td>{{ loop.index }}</td>
        <td>{{ machine.name }}</td>
        <td>{{ machine.owner.email }}</td>
        <td>
            <ul>
                {% for head in machine.heads %}
                    <li>Head {{ head.number }} – <a href="{{ url_for('main.head_view', machine_id=machine.id, head_id=head.id) }}">View</a></li>
                {% endfor %}
            </ul>
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}
{% endblock %}
